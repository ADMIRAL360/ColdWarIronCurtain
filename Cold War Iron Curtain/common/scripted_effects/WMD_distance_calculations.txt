wmd_nuclear_range_calculation = {
	set_variable = { ICBM_Distance = 0 }
	set_variable = { IRBM_Distance = 0 }
	set_variable = { Strat_Distance = 0 }
	#icbm range
	if = { limit = { has_tech = icbm5 } set_variable = { ICBM_Distance = 22000 } }
	else_if = { limit = { has_tech = icbm4 } set_variable = { ICBM_Distance = 22000 } }
	else_if = { limit = { has_tech = icbm3 } set_variable = { ICBM_Distance = 18000 } }
	else_if = { limit = { has_tech = icbm2 } set_variable = { ICBM_Distance = 16000 } }
	else_if = { limit = { has_tech = icbm1 } set_variable = { ICBM_Distance = 14000 } }
	else = { set_variable = { ICBM_Distance = 0 } }
	#irbm range
	if = { limit = { has_tech = irbm8 } set_variable = { IRBM_Distance = 8000 } }
	else_if = { limit = { has_tech = irbm7 } set_variable = { IRBM_Distance = 7000 } }
	else_if = { limit = { has_tech = irbm6 } set_variable = { IRBM_Distance = 6000 } }
	else_if = { limit = { has_tech = irbm5 } set_variable = { IRBM_Distance = 5000 } }
	else_if = { limit = { has_tech = irbm4 } set_variable = { IRBM_Distance = 4000 } }
	else_if = { limit = { has_tech = irbm3 } set_variable = { IRBM_Distance = 3000 } }
	else_if = { limit = { has_tech = irbm2 } set_variable = { IRBM_Distance = 2000 } }
	else_if = { limit = { has_tech = irbm1 } set_variable = { IRBM_Distance = 1000 } }
	else = { set_variable = { IRBM_Distance = 0 } }
	#strat bomber range
	if = { limit = { has_tech = stealth_strategic_bomber2 } set_variable = { Strat_Distance = 12000 } }
	else_if = { limit = { has_tech = stealth_strategic_bomber1 } set_variable = { Strat_Distance = 11000 } }
	else_if = { limit = { has_tech = jet_strategic_bomber5 } set_variable = { Strat_Distance = 10000 } }
	else_if = { limit = { has_tech = jet_strategic_bomber4 } set_variable = { Strat_Distance = 9000 } }
	else_if = { limit = { has_tech = jet_strategic_bomber3 } set_variable = { Strat_Distance = 8000 } }
	else_if = { limit = { has_tech = jet_strategic_bomber2 } set_variable = { Strat_Distance = 7000 } }
	else_if = { limit = { has_tech = jet_strategic_bomber1 } set_variable = { Strat_Distance = 6000 } }
	else_if = { limit = { has_tech = strategic_bomber3 } set_variable = { Strat_Distance = 5000 } }
	else = { set_variable = { Strat_Distance = 0 } }

	set_variable = { WMD_Strike_Distance = 0 }
	if = { limit = { check_variable = { ICBM_Distance > WMD_Strike_Distance } } set_variable = { WMD_Strike_Distance = ICBM_Distance } }
	if = { limit = { check_variable = { IRBM_Distance > WMD_Strike_Distance } } set_variable = { WMD_Strike_Distance = IRBM_Distance } }
	if = { limit = { check_variable = { Strat_Distance > WMD_Strike_Distance } } set_variable = { WMD_Strike_Distance = Strat_Distance } }
}

wmd_nuclear_cost_and_damage = {
	set_variable = { nuke_cost = warhead_cost }
	if = { limit = { has_tech = atomic_weapons_delivery_V } divide_variable = { warhead_cost = 8 } }
	else_if = { limit = { has_tech = atomic_weapons_delivery_IV } divide_variable = { warhead_cost = 8 } }
	else_if = { limit = { has_tech = atomic_weapons_delivery_III } divide_variable = { warhead_cost = 8 } }
	else_if = { limit = { has_tech = atomic_weapons_delivery_II } divide_variable = { warhead_cost = 8 } }
	else_if = { limit = { has_tech = atomic_weapons_delivery_Ia } divide_variable = { warhead_cost = 8 } }
	else_if = { limit = { has_tech = atomic_weapons_delivery_I } divide_variable = { warhead_cost = 4 } }
	round_variable = warhead_cost

	set_variable = { warhead_damage = 0 }
	if = { limit = { has_tech = atomic_weapons_armament_II } add_to_variable = { warhead_damage = 100 } }
	else_if = { limit = { has_tech = atomic_weapons_armament_I } add_to_variable = { warhead_damage = 50 } }
	else_if = { limit = { has_tech = atomic_weapons_armament_0 } add_to_variable = { warhead_damage = 5 } }
}

# STRIKES states selection
distance_calculator_all_tiers = {
	clear_array = ROOT.WMD_target_states_array
	set_variable = { ROOT.warhead_cost = 0 }
	wmd_nuclear_range_calculation = yes

	log = "generic TIER STRIKE / Strike Distance = [?ROOT.WMD_Strike_Distance]"

	every_state = {
		limit = {
			#Is owned by an enemy country
			any_country = {
				controls_state = PREV
				has_war_with = ROOT
				check_variable = { THIS.checkmark = 1 }
			}
			# and is in range of an allied airbase
			OR = {
				#in range of one of our airbases
				ROOT = {
					any_owned_state = {
						air_base > 0
						check_variable = { THIS.distance_to@PREV.PREV < ROOT.WMD_Strike_Distance}	#MAP_SCALE_PIXEL_TO_KM = 7.114
					}
				}
				#in range of one of our subject's airbases
				any_country = {
					is_subject_of = ROOT
					any_owned_state = {
						air_base > 0
						check_variable = { THIS.distance_to@PREV.PREV < ROOT.WMD_Strike_Distance}	#MAP_SCALE_PIXEL_TO_KM = 7.114
					}
				}
				#in range of one of our allies' airbases
				any_country = {
					is_in_faction_with = ROOT
					any_owned_state = {
						air_base > 0
						check_variable = { THIS.distance_to@PREV.PREV < ROOT.WMD_Strike_Distance}	#MAP_SCALE_PIXEL_TO_KM = 7.114
					}
				}
			}
		}

		if = {
			limit = {
				NOT = {
					is_in_array = {
						array = ROOT.WMD_target_states_array
						value = THIS.id
					}
				}
				OR = {
					# all strike levels
					is_capital = yes
					# strike level 2
					AND = {
						check_variable = { ROOT.strike_level_tier2_selected = 1 }
						OR = {
							state_population_k > 5000
							nuclear_reactor > 0
							controller = {
								divisions_in_state = {
									size > 9
									state = PREV
								}
							}
						}
					}
					# strike level 3
					AND = {
						check_variable = { ROOT.strike_level_tier3_selected = 1 }
						OR = {
							state_population_k > 1000
							controller = {
								divisions_in_state = {
									size > 4
									state = PREV
								}
							}
							nuclear_reactor > 0
						}
					}
				}
			}
			#log = "[THIS.GetName] - [?state_population_k] k"
			add_to_array = { ROOT.WMD_target_states_array = THIS.id }
			add_to_variable = { ROOT.warhead_cost = 1 }
			set_variable = { state_pop_total = state_population_k }
			add_to_variable = { warhead_damage_local = 1 }

			if = { limit = { check_variable = { state_pop_total > 1000 } }
				divide_variable = { state_pop_total = 1000 }
				round_variable = state_pop_total
				if = { limit = { check_variable = { ROOT.strike_level_tier1_selected = 1 } }
					add_to_variable = { ROOT.warhead_cost = 1 }
				}
				else_if = { limit = { check_variable = { ROOT.strike_level_tier2_selected = 1 } }
					add_to_variable = { ROOT.warhead_cost = 1 }
					add_to_variable = { warhead_damage_local = 1 }
				}
				else_if = { limit = { check_variable = { ROOT.strike_level_tier3_selected = 1 } }
					add_to_variable = { ROOT.warhead_cost = state_pop_total }
				}
			}
		}
	}
	log = "WMD_num_target_states: [?WMD_num_target_states]"
	wmd_nuclear_cost_and_damage = yes
	add_to_variable = { ROOT.refresh_wmd_menu = 1 }
}


slbm_mid_east_calc = {
	clear_array = SLBMTargetList
	every_state = {
		limit = {
			#Is owned by an enemy country
			any_country = {
				controls_state = PREV
				has_war_with = ROOT
			}
			is_on_continent = middle_east
		}
		if = {
			limit = {
				NOT = {
					is_in_array = {
						array = ROOT.SLBMTargetList
						value = THIS.id
					}
				}
			}
			add_to_array = { ROOT.SLBMTargetList = THIS.id }
		}
	}
}

distance_calculator_sov_cubamc = {
	clear_array = WMD_target_states_array
	set_variable = { warhead_cost = 0 }

	wmd_nuclear_range_calculation = yes

	every_state = {
		limit = {
			#Is owned by an enemy country
			any_country = {
				OR = {
					tag = USA
					has_idea = SEATO_member
					has_idea = CENTO_member
					has_idea = nato_member
					is_in_faction_with = USA
				}
			}
			OR = {
				ROOT = {
					any_owned_state = {
						air_base > 0
						check_variable = { THIS.distance_to@PREV.PREV < ROOT.WMD_Strike_Distance}	#MAP_SCALE_PIXEL_TO_KM = 7.114
					}
				}
				any_country = {
					is_subject_of = ROOT
					any_owned_state = {
						air_base > 0
						check_variable = { THIS.distance_to@PREV.PREV < ROOT.WMD_Strike_Distance}	#MAP_SCALE_PIXEL_TO_KM = 7.114
					}
				}
				any_country = {
					is_in_faction_with = ROOT
					any_owned_state = {
						air_base > 0
						check_variable = { THIS.distance_to@PREV.PREV < ROOT.WMD_Strike_Distance}	#MAP_SCALE_PIXEL_TO_KM = 7.114
					}
				}
			}
		}
		if = {
			limit = {
				NOT = {
					is_in_array = {
						array = ROOT.WMD_target_states_array
						value = THIS.id
					}
				}
				OR = {
					is_capital = yes
					state_population_k > 1000
					controller = {
						divisions_in_state = {
							size > 4
							state = PREV
						}
					}
					nuclear_reactor > 0
				}
			}
			add_to_array = { ROOT.WMD_target_states_array = THIS.id }
			add_to_variable = { ROOT.warhead_cost = 1 }
			set_variable = { state_pop_total = state_population_k }

			if = { limit = { check_variable = { state_pop_total > 1000 } }
				divide_variable = { state_pop_total = 1000 }
				round_variable = state_pop_total
				add_to_variable = { ROOT.warhead_cost = state_pop_total }
			}
		}
	}
	wmd_nuclear_cost_and_damage = yes
}

distance_calculator_usa_cubamc = {
	clear_array = WMD_target_states_array
	set_variable = { warhead_cost = 0 }

	wmd_nuclear_range_calculation = yes

	every_state = {
		limit = {
			#Is owned by an enemy country
			any_country = {
				OR = {
					tag = SOV
					tag = CUB
					tag = PRC
					is_in_faction_with = SOV
				}
			}
			OR = {
				ROOT = {
					any_owned_state = {
						air_base > 0
						check_variable = { THIS.distance_to@PREV.PREV < ROOT.WMD_Strike_Distance}	#MAP_SCALE_PIXEL_TO_KM = 7.114
					}
				}
				any_country = {
					is_subject_of = ROOT
					any_owned_state = {
						air_base > 0
						check_variable = { THIS.distance_to@PREV.PREV < ROOT.WMD_Strike_Distance}	#MAP_SCALE_PIXEL_TO_KM = 7.114
					}
				}
				any_country = {
					is_in_faction_with = ROOT
					any_owned_state = {
						air_base > 0
						check_variable = { THIS.distance_to@PREV.PREV < ROOT.WMD_Strike_Distance}	#MAP_SCALE_PIXEL_TO_KM = 7.114
					}
				}
			}
		}
		if = {
			limit = {
				NOT = {
					is_in_array = {
						array = ROOT.WMD_target_states_array
						value = THIS.id
					}
				}
				OR = {
					is_capital = yes
					state_population_k > 1000
					controller = {
						divisions_in_state = {
							size > 4
							state = PREV
						}
					}
					nuclear_reactor > 0
				}
			}
			add_to_array = { ROOT.WMD_target_states_array = THIS.id }
			add_to_variable = { ROOT.warhead_cost = 1 }
			set_variable = { state_pop_total = state_population_k }

			if = { limit = { check_variable = { state_pop_total > 1000 } }
				divide_variable = { state_pop_total = 1000 }
				round_variable = state_pop_total
				add_to_variable = { ROOT.warhead_cost = state_pop_total }
			}
		}
	}
	wmd_nuclear_cost_and_damage = yes
}

distance_calculator_chemical_stateview = {
	clear_array = WarCrimeTargetListChemical
	every_state = {
		limit = {
			#Is owned by an enemy country
			any_country = {
				controls_state = PREV
				has_war_with = ROOT
			}
			OR = {
				ROOT = {
					any_owned_state = {
						air_base > 0
						check_variable = { THIS.distance_to@PREV.PREV < 200 }	#MAP_SCALE_PIXEL_TO_KM = 7.114
					}
				}
				any_country = {
					is_subject_of = ROOT
					any_owned_state = {
						air_base > 0
						check_variable = { THIS.distance_to@PREV.PREV < 200 }	#MAP_SCALE_PIXEL_TO_KM = 7.114
					}
				}
				any_country = {
					is_in_faction_with = ROOT
					any_owned_state = {
						air_base > 0
						check_variable = { THIS.distance_to@PREV.PREV < 200 }	#MAP_SCALE_PIXEL_TO_KM = 7.114
					}
				}
			}
		}
		if = {
			limit = {
				NOT = {
					is_in_array = {
						array = ROOT.WarCrimeTargetListChemical
						value = THIS.id
					}
				}
			}
			add_to_array = { ROOT.WarCrimeTargetListChemical = THIS.id }
		}
	}
}
